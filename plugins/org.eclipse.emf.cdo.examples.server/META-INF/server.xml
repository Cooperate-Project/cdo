<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"
		"http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

	<!-- ######################################################## -->
	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value> plugin:/META-INF/server.properties </value>
			</list>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="acceptor" class="org.eclipse.net4j.socket.impl.SocketAcceptorImpl">
		<property name="listenAddr">
			<value>${acceptor.listenAddr}</value>
		</property>
		<property name="listenPort">
			<value>${acceptor.listenPort}</value>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="slave" singleton="false"
		class="org.eclipse.net4j.socket.impl.PassiveSocketConnectorImpl">
		<property name="bufferPool">
			<ref bean="bufferPool"/>
		</property>
		<property name="connectionManager">
			<ref bean="connectionManager"/>
		</property>
		<property name="protocolManager">
			<ref bean="protocolManager"/>
		</property>
		<property name="selectorManager">
			<ref bean="selectorManager"/>
		</property>
	</bean>

	<!--
		CDO Server Part 
	-->

	<!-- ######################################################## -->
	<bean id="packageManager" class="org.eclipse.emf.cdo.server.impl.PackageManagerImpl"/>

	<!-- ######################################################## -->
	<bean id="resourceManager" class="org.eclipse.emf.cdo.server.impl.ResourceManagerImpl"/>

	<!-- ######################################################## -->
	<bean id="columnConverter" class="org.eclipse.emf.cdo.server.impl.ColumnConverterImpl"/>

	<!-- ######################################################## -->
	<bean id="serverCDOProtocol" class="org.eclipse.emf.cdo.server.protocol.ServerCDOProtocolImpl">
		<property name="protocolManager">
			<ref bean="protocolManager"/>
		</property>
		<property name="transactionTemplate">
			<ref local="transactionTemplate"/>
		</property>
		<property name="mapper">
			<ref local="mapper"/>
		</property>
		<property name="serverCDOResProtocol">
			<ref local="serverCDOResProtocol"/>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="serverCDOResProtocol"
		class="org.eclipse.emf.cdo.server.protocol.ServerCDOResProtocolImpl">
		<property name="protocolManager">
			<ref bean="protocolManager"/>
		</property>
		<property name="transactionTemplate">
			<ref local="transactionTemplate"/>
		</property>
		<property name="mapper">
			<ref local="mapper"/>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="dataSource" class="org.eclipse.net4j.spring.db.ContextClassLoaderDataSource">
		<property name="driverClassName">
			<value>${jdbc.driver}</value>
		</property>
		<property name="url">
			<value>${jdbc.url}</value>
		</property>
		<property name="username">
			<value>${jdbc.username}</value>
		</property>
		<property name="password">
			<value>${jdbc.password}</value>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="transactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource">
			<ref local="dataSource"/>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="transactionTemplate"
		class="org.springframework.transaction.support.TransactionTemplate">
		<property name="transactionManager">
			<ref local="transactionManager"/>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource">
			<ref local="dataSource"/>
		</property>
	</bean>

	<!-- ######################################################## -->
	<bean id="mapper" class="org.eclipse.emf.cdo.server.impl.MapperImpl">
		<property name="columnConverter">
			<ref local="columnConverter"/>
		</property>
		<property name="packageManager">
			<ref local="packageManager"/>
		</property>
		<property name="resourceManager">
			<ref local="resourceManager"/>
		</property>
		<property name="dataSource">
			<ref local="dataSource"/>
		</property>
		<property name="jdbcTemplate">
			<ref local="jdbcTemplate"/>
		</property>
		<property name="oidEncoder" >
			<ref bean="oidEncoder"/>
		</property>
		<property name="sqlDialectName">
			<value>${jdbc.dialect}</value>
		</property>
	</bean>

</beans>
